<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
    
    <changeSet author="description" id="description">
        <createTable tableName="description">
            <column name="description_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="description" type="MEDIUMTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="gpt_func" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="cve_id" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="description_index_desc_id"
            tableName="description"
            unique="false">
            <column name="description_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="rawdescription" id="rawdescription">
        <createTable tableName="rawdescription">
            <column name="raw_description_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="raw_description" type="MEDIUMTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="published_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="source_url" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="is_garbage" type="INT" defaultValue="0">
                <constraints nullable="false" />
            </column>
            <column name="source_type" type="VARCHAR(20)" defaultValue="other">
                <constraints nullable="false" />
            </column>
            <column name="parser_type" type="VARCHAR(30)">
                <constraints nullable="false" />
            </column>
        </createTable>

        <createIndex
            indexName="raw_description_index_id"
            tableName="rawdescription"
            unique="false">
            <column name="raw_description_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="rawdescriptionjt" id="rawdescriptionjt">
        <createTable tableName="rawdescriptionjt">
            <column name="description_joint_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="description_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="raw_description_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="description_index_joint_id"
            tableName="rawdescriptionjt"
            unique="false">
            <column name="description_joint_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="rawdescriptionjt"
            baseColumnNames="description_id"
            referencedTableName="description"
            referencedColumnNames="description_id"
            constraintName="description_joint_description_id_fk"/>

        <addForeignKeyConstraint
            baseTableName="rawdescriptionjt"
            baseColumnNames="raw_description_id"
            referencedTableName="rawdescription"
            referencedColumnNames="raw_description_id"
            constraintName="description_joint_raw_description_id_fk"/>
    </changeSet>

    <changeSet author="vulnerability" id="vulnerability">
        <createTable tableName="vulnerability">
            <column name="vuln_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="description_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="published_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="vuln_id_UNIQUE"
            tableName="vulnerability"
            unique="true">
            <column name="vuln_id"/>
        </createIndex>

         <createIndex
            indexName="vulnerability_index_cve_id"
            tableName="vulnerability"
            unique="false">
            <column name="cve_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="vulnerability"
            baseColumnNames="description_id"
            referencedTableName="description"
            referencedColumnNames="description_id"
            constraintName="description_id_fk"/>

        <addUniqueConstraint
                columnNames="cve_id"
                tableName="vulnerability"/>
    </changeSet>

    <changeSet author="affectedproduct" id="affectedproduct">
        <createTable tableName="affectedproduct">
            <column name="affected_product_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="cpe" type="VARCHAR(300)">
                <constraints nullable="false"/>
            </column>
            <column name="release_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="product_name" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="vendor" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="purl" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="swid_tag" type="VARCHAR(1000)">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <createIndex
            indexName="affected_product_id_index"
            tableName="affectedproduct"
            unique="false">
            <column name="affected_product_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="affectedproduct"
            baseColumnNames="cve_id"
            referencedTableName="vulnerability"
            referencedColumnNames="cve_id"
            constraintName="affectedproduct_cve_id_fk"/>

    </changeSet>

    <changeSet author="cvss" id="cvss">
        <createTable tableName="cvss">
            <column name="cvss_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="create_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="base_score" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="impact_score" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="int">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <createIndex
            indexName="cvss_cve_id_index"
            tableName="cvss"
            unique="false">
            <column name="cve_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="cvss"
            baseColumnNames="cve_id"
            referencedTableName="vulnerability"
            referencedColumnNames="cve_id"
            constraintName="cvssscore_cve_id_fk"/>
    </changeSet>

    <changeSet author="exploit" id="exploit">
        <createTable tableName="exploit">
            <column name="exploit_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="exploit_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="exploit_source" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="exploit_id_index"
            tableName="exploit"
            unique="false">
            <column name="exploit_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="exploit"
            baseColumnNames="cve_id"
            referencedTableName="vulnerability"
            referencedColumnNames="cve_id"
            constraintName="exploit_cve_id_fk"/>
    </changeSet>

    <changeSet author="nvdmitrestatus" id="nvdmitrestatus">
        <createTable tableName="nvdmitrestatus">
            <column name="nvdmitrestatus_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="exists_nvd" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="exists_mitre" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="nvdmitrestatus_id_index"
            tableName="nvdmitrestatus"
            unique="false">
            <column name="nvdmitrestatus_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="nvdmitrestatus"
            baseColumnNames="cve_id"
            referencedTableName="vulnerability"
            referencedColumnNames="cve_id"
            constraintName="nvdmitrestatus_cve_id_fk"/>
    </changeSet>

    <changeSet author="patchsourceurl" id="patchsourceurl">
        <createTable tableName="patchsourceurl">
            <column name="source_url_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="source_url" type="VARCHAR(500)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="source_url_id_index"
            tableName="patchsourceurl"
            unique="false">
            <column name="source_url_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="patchsourceurl"
            baseColumnNames="cve_id"
            referencedTableName="vulnerability"
            referencedColumnNames="cve_id"
            constraintName="patch_source_cve_id_fk"
            onDelete="CASCADE"
        />
    </changeSet>

    <changeSet author="patchcommit" id="patchcommit">
        <createTable tableName="patchcommit">
            <column name="commit_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="source_url_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="commit_sha" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="commit_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="commit_message" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="uni_diff" type="VARCHAR(500)">
                <constraints nullable="false"/>
            </column>
            <column name="timeline" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="time_to_patch" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="lines_changed" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="commit_id_index"
            tableName="patchcommit"
            unique="false">
            <column name="commit_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="patchcommit"
            baseColumnNames="source_url_id"
            referencedTableName="patchsourceurl"
            referencedColumnNames="source_url_id"
            constraintName="source_url_id_fk"/>
    </changeSet>

    <changeSet author="runhistory" id="runhistory">
        <createTable tableName="runhistory">
            <column name="runhistory_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="run_start_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="run_end_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="runhistory_id_idx"
            tableName="runhistory"
            unique="false">
            <column name="runhistory_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="vdocharacteristic" id="vdocharacteristic">
        <createTable tableName="vdocharacteristic">
            <column name="vdo_characteristic_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="vdo_label" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="vdo_noun_group" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="vdo_confidence" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="int">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <createIndex
            indexName="vdocharacteristic_cve_id_index"
            tableName="vdocharacteristic"
            unique="false">
            <column name="cve_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="vdocharacteristic"
            baseColumnNames="cve_id"
            referencedTableName="vulnerability"
            referencedColumnNames="cve_id"
            constraintName="vdocharacteristic_cve_id_fk"/>
    </changeSet>

    <changeSet author="vulnerabilityaggregate" id="vulnerabilityaggregate">
        <createTable tableName="vulnerabilityaggregate">
            <column name="vuln_id" type="INT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="MEDIUMTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="published_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="fixed_date" type="DATETIME">
                <constraints nullable="true"/>
            </column>
            <column name="exists_at_nvd" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="exists_at_mitre" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="vdo_labels" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="vdo_label_confidences" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="vdo_noun_groups" type="TINYTEXT">
                <constraints nullable="true"/>
            </column>
            <column name="source_urls" type="MEDIUMTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="base_scores" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="impact_scores" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="cpes" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="exploit_publish_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="exploit_url" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
            <column name="runhistory_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="aggregate_vuln_id"
            tableName="vulnerabilityaggregate"
            unique="true">
            <column name="vuln_id"/>
        </createIndex>

         <createIndex
            indexName="aggregate_run_date_time_id"
            tableName="vulnerabilityaggregate"
            unique="false">
            <column name="runhistory_id"/>
        </createIndex>

        <addForeignKeyConstraint
            baseTableName="vulnerabilityaggregate"
            baseColumnNames="cve_id"
            referencedTableName="vulnerability"
            referencedColumnNames="cve_id"
            constraintName="aggregate_cve_id"/>

        <addForeignKeyConstraint
            baseTableName="vulnerabilityaggregate"
            baseColumnNames="runhistory_id"
            referencedTableName="runhistory"
            referencedColumnNames="runhistory_id"
            constraintName="aggregate_run_date_time_id"/>

        <addUniqueConstraint
                columnNames="cve_id"
                tableName="vulnerabilityaggregate"/>
    </changeSet>

    <changeSet author="cvejobtrack" id="cvejobtrack">
        <createTable tableName="cvejobtrack">
            <column name="cve_id" type="VARCHAR(20)">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
        </createTable>

        <createIndex
            indexName="cvejobtrack_index_cve_id"
            tableName="cvejobtrack"
            unique="true">
            <column name="cve_id"/>
        </createIndex>

        <addUniqueConstraint
                columnNames="cve_id"
                tableName="cvejobtrack"/>
    </changeSet>

    <changeSet author="nvddata" id="nvddata">
        <createTable tableName="nvddata">
            <column name="cve_id" type="VARCHAR(20)">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="published_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
            indexName="nvddata_index_cve_id"
            tableName="nvddata"
            unique="true">
            <column name="cve_id"/>
        </createIndex>

        <addUniqueConstraint
                columnNames="cve_id"
                tableName="nvddata"/>
    </changeSet>

    <changeSet author="memeee" id="affectedproduct-remove-date">
        <dropColumn tableName="affectedproduct" columnName="release_date"/>
    </changeSet>

    <changeSet id="createPermissionTable" author="memeee">
        <createTable tableName="permission">
            <column name="permission_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="permission_name" type="varchar(45)"/>
        </createTable>
    </changeSet>

    <changeSet id="createRoleTable" author="memeee">
        <createTable tableName="role">
            <column name="role_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="name" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="createUserTable" author="memeee">
        <createTable tableName="user">
            <column name="user_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="user_name" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="password_hash" type="varchar(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="token" type="varchar(512)">
                <constraints nullable="true"/>
            </column>
            <column name="token_expiration_date" type="datetime">
                <constraints nullable="true"/>
            </column>
            <column name="first_name" type="varchar(50)">
                <constraints nullable="true"/>
            </column>
            <column name="last_name" type="varchar(50)">
                <constraints nullable="true"/>
            </column>
            <column name="role_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="varchar(45)">
                <constraints nullable="true"/>
            </column>
            <column name="registered_date" type="datetime">
                <constraints nullable="true"/>
            </column>
            <column name="last_login_date" type="datetime">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addUniqueConstraint columnNames="user_name" constraintName="user_name_idx" tableName="user"/>
        <addForeignKeyConstraint baseColumnNames="role_id" baseTableName="user" constraintName="user_role"
                                 referencedColumnNames="role_id" referencedTableName="role"/>
    </changeSet>



    <changeSet id="createUserPermissionTable" author="memeee">
        <createTable tableName="userpermission">
            <column name="user_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="permission_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date" type="datetime">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="user_id, permission_id" tableName="userpermission"/>
        <addForeignKeyConstraint baseColumnNames="permission_id" baseTableName="userpermission"
                                 constraintName="userpermission_permission_id_fk"
                                 referencedColumnNames="permission_id" referencedTableName="permission"/>
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="userpermission"
                                 constraintName="userpermission_user_id_fk"
                                 referencedColumnNames="user_id" referencedTableName="user"/>
    </changeSet>


    <changeSet id="removeColumnsFromRunHistory" author="memeee">
        <dropColumn tableName="runhistory" columnName="run_start_date" />
        <dropColumn tableName="runhistory" columnName="run_end_date" />
    </changeSet>

    <!-- Add new columns to the existing table -->
    <changeSet id="enhanceRunHistory" author="memeee">
        <addColumn tableName="runhistory">
            <column name="run_date_time" type="datetime" />
            <column name="total_cve_count" type="int" />
            <column name="new_cve_count" type="int" />
            <column name="updated_cve_count" type="int" />
            <column name="not_in_nvd_count" type="int" />
            <column name="not_in_mitre_count" type="int" />
            <column name="not_in_both_count" type="int" />
            <column name="avg_time_gap_nvd" type="double" />
            <column name="avg_time_gap_mitre" type="double" />
        </addColumn>
    </changeSet>

    <changeSet id="dropVulnerabilityAggregate" author="dylan">
        <dropTable tableName="vulnerabilityaggregate" cascadeConstraints="true"/>
    </changeSet>

    <changeSet id="dropNvdMitreStatus" author="memeee">
        <dropTable tableName="nvdmitrestatus"/>
    </changeSet>

    <changeSet id="createTimegapTable" author="memeee">
        <createTable tableName="timegap">
            <column name="timegap_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_timegap"/>
            </column>
            <column name="cve_id" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="timegap" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex tableName="timegap" indexName="timegap_cve_id_index" unique="false">
            <column name="cve_id"/>
        </createIndex>

        <addForeignKeyConstraint baseTableName="timegap" baseColumnNames="cve_id"
                                 referencedTableName="vulnerability" referencedColumnNames="cve_id"
                                 constraintName="timegap_cve_id_fk"/>

        <addUniqueConstraint tableName="timegap" columnNames="cve_id, location" constraintName="uk_timegap_cve_id_location"/>

    </changeSet>

    <changeSet id="createMitreDataTable" author="memeee">
        <createTable tableName="mitredata">
            <column name="cve_id" type="VARCHAR(20)">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="status" type="TINYTEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createIndex
                indexName="mitredata_index_cve_id"
                tableName="mitredata"
                unique="true">
            <column name="cve_id"/>
        </createIndex>

        <addUniqueConstraint
                columnNames="cve_id"
                tableName="nvddata"/>
    </changeSet>

    <changeSet id="addNvdLastModifiedColumn" author="memeee">
        <addColumn tableName="nvddata">
            <column name="last_modified" type="datetime">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="addMitreLastModifiedColumn" author="memeee">
        <addColumn tableName="mitredata">
            <column name="last_modified" type="datetime">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="addDescriptionUserId" author="memeee">
        <addColumn tableName="description">
            <column name="is_user_generated" type="int" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="addVdoActiveFlag" author="memeee">
        <addColumn tableName="vdocharacteristic">
            <column name="is_active" type="int"  defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="modify-gpt_func" author="memeee">
        <modifyDataType tableName="description" columnName="gpt_func" newDataType="MEDIUMTEXT"/>
    </changeSet>

    <changeSet id="remove-redundant-user-key" author="memeee">
        <dropUniqueConstraint constraintName="user_id" tableName="user"/>
    </changeSet>

    <changeSet id="remove-redundant-role-key" author="memeee">
        <dropUniqueConstraint constraintName="role_id" tableName="role"/>
    </changeSet>

    <changeSet id="remove-redundant-permission-key" author="memeee">
        <dropUniqueConstraint constraintName="permission_id" tableName="permission"/>
    </changeSet>

    <changeSet id="remove-redundant-cvss-column" author="memeee">
        <dropColumn tableName="cvss" columnName="base_score"/>
        <renameColumn tableName="cvss" oldColumnName="impact_score" newColumnName="base_score" columnDataType="DOUBLE"/>
    </changeSet>

    <changeSet id="createNvdSourceUrlTable" author="dylan">
        <createTable tableName="nvdsourceurl">
            <column name="source_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="source_url" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="nvdsourceurl" baseColumnNames="cve_id"
                                 referencedTableName="nvddata" referencedColumnNames="cve_id"
                                 constraintName="nvdsourceurl_cve_id_fk"/>
    </changeSet>

    <changeSet id="addUniqueConstraintNvdSourceUrl" author="dylan">
        <addUniqueConstraint tableName="nvdsourceurl" columnNames="cve_id, source_url" constraintName="uk_nvdsourceurl_cve_id_source_url"/>
    </changeSet>

    <changeSet id="createFixSourceUrlTable" author="dylan">
        <createTable tableName="fixsourceurl">
            <column name="source_url_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="source_url" type="VARCHAR(500)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="createFixesTable" author="dylan">
        <createTable tableName="fixes">
            <column name="fix_id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="fix_description" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="source_url_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="fixes" baseColumnNames="source_url_id"
                                 referencedTableName="fixsourceurl" referencedColumnNames="source_url_id"
                                 constraintName="fixes_source_url_id_fk"/>
    </changeSet>

    <changeSet id="increaseNvdSourceUrlSize" author="dylan">
        <modifyDataType columnName="source_url"
                        newDataType="VARCHAR(500)"
                        schemaName="nvip"
                        tableName="nvdsourceurl"/>
    </changeSet>

    <changeSet id="dropFixSourceUrl" author="dylan">
        <dropForeignKeyConstraint  baseTableName="fixes" constraintName="fixes_source_url_id_fk"/>
        <dropTable tableName="fixsourceurl" cascadeConstraints="true" />
    </changeSet>

    <changeSet id="addSourceUrlColumnFixTable" author="dylan">
        <dropColumn tableName="fixes" columnName="source_url_id"/>
        <addColumn tableName="fixes">
            <column name="source_url" type="VARCHAR(500)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- TODO: Make sure this is right  -->
    <changeSet id="addFixesUniqueIndex" author="dylan">
        <createIndex tableName="fixes" indexName="cve_source_index" unique="true">
            <column name="cve_id"/>
            <column name="source_url"/>
        </createIndex>
    </changeSet>

    <changeSet id="recreateExploitTable" author="dylan">
        <dropTable tableName="exploit"/>
        <createTable tableName="exploit" >
            <column name="id" autoIncrement="true" type="SERIAL">
                <constraints primaryKey="true" nullable="false" unique="true"/>
            </column>
            <column name="name" type="VARCHAR(750)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="true"/>
            </column>
            <column name="example_file" type="VARCHAR(100)">
                <constraints nullable="true"/>
            </column>
            <column name="author" type="VARCHAR(750)">
                <constraints nullable="true"/>
            </column>
            <column name="date_published" type="DATE">
                <constraints nullable="true"/>
            </column>
            <column name="is_repo" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="source" type="VARCHAR(500)">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="VARCHAR(50)">
                <constraints nullable="true"/>
            </column>
            <column name="download_failed" type="TINYINT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="cve_id" type="VARCHAR(20)">
                <constraints nullable="true"/>
            </column>
            <column name="source_url" type="VARCHAR(1000)">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>


</databaseChangeLog>