package edu.rit.se.nvip.model;

import java.sql.Timestamp;
import java.text.DecimalFormat;
import java.text.NumberFormat;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;


/**
 * Simple model to represent all fields shared between a RawVulnerability and a CompositeVulnerability
 */
public class Vulnerability {
    protected final NumberFormat formatter = new DecimalFormat("#0.00");
    protected final DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");

    protected int vulnID = 0;
    protected String cveId = null; // CVE ID
    protected String description = null; // CVE description text
    protected Timestamp publishDate = null; // The date time it is published
    protected Timestamp createDate = null; // The time the entry is created at NVIP DB
    protected Timestamp lastModifiedDate = null;

    public Vulnerability() {}

    /**
     * For comparing w/ NVD
     * @param cveId
     * @param publishDate
     */

    public Vulnerability(String cveId, Timestamp publishDate) {
        this.cveId = cveId;
        this.publishDate = publishDate;
    }

    /**
     * For comparing w/ Mitre
     * @param cveId
     */

    public Vulnerability(String cveId) {
        this.cveId = cveId;
    }


    public Vulnerability(String cveId, String description, Timestamp publishDate, Timestamp lastModifiedDate, Timestamp createDate) {
        this.cveId = cveId;
        this.description = description;
        this.publishDate = publishDate;
        this.lastModifiedDate = lastModifiedDate;
        this.createDate = createDate;
    }

    /**
     * Constructor for vulnerability updates
     *
     * @param vuln_id
     * @param description
     * @param existAtNvd
     * @param existAtMitre
     * @param createdDate
     */
    public Vulnerability(int vuln_id, String cveId, String description, int existAtNvd, int existAtMitre, Timestamp createdDate) {
        this.vulnID = vuln_id;
        this.description = description;
        this.cveId = cveId;
        if (createdDate != null) {
            this.createDate = createdDate;
        } else {
            this.createDate = Timestamp.valueOf(LocalDateTime.now().format(dateTimeFormatter));
        }
    }

    public Vulnerability(String cveId, Timestamp publishDate, Timestamp lastModifiedDate) {
        this.cveId = cveId;
        this.publishDate = publishDate;
        this.lastModifiedDate = lastModifiedDate;

    }

    public int getVulnID() {
        return vulnID;
    }

    public String getCveId() {
        return cveId;
    }

    public Timestamp getPublishDate() {
        return publishDate;
    }

    public Timestamp getLastModifiedDate() { return lastModifiedDate; }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public void setCveId(String cveId) {
        this.cveId = cveId;
    }

    public Timestamp getCreateDate() { return createDate; }
}
