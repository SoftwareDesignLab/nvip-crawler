package edu.rit.se.nvip.model;

import java.sql.Timestamp;
import java.util.Arrays;
import java.util.Optional;

/**
 * Simple model to represent a RawVulnerability (a row in the rawdescriptions table)
 */
public class RawVulnerability extends Vulnerability{

    private final String sourceUrl;
    private final int id;

    public enum SourceType {
        CNA("cna"),
        SA("security_advisory"),
        THIRD_PARTY("third_party"),
        BUG_BOUNTY("bug_bounty"),
        OTHER("other");

        private final String label;
        SourceType(String label) {
            this.label = label;
        }
        public String getLabel() {
            return this.label;
        }
        public static SourceType get(String sourceType) {
            return Arrays.stream(SourceType.values()).filter(st -> st.label.equals(sourceType)).findFirst().orElse(OTHER);
        }
    }

    private final SourceType sourceType;

    public RawVulnerability(int id, String cveId, String description, Timestamp publishDate, Timestamp lastModifiedDate, Timestamp createDate, String sourceUrl, String sourceType) {
        super(cveId, description, publishDate, lastModifiedDate, createDate);
        this.id = id;
        this.sourceUrl = sourceUrl;
        this.sourceType = SourceType.get(sourceType);
    }

    /**
     * Constructor just missing the sourceType arg. This exists so I don't need to update dozens of tests
     * // todo dump this constructor
     * @param id
     * @param cveId
     * @param description
     * @param publishDate
     * @param lastModifiedDate
     * @param createDate
     * @param sourceUrl
     */
    public RawVulnerability(int id, String cveId, String description, Timestamp publishDate, Timestamp lastModifiedDate, Timestamp createDate, String sourceUrl) {
        super(cveId, description, publishDate, lastModifiedDate, createDate);
        this.id = id;
        this.sourceUrl = sourceUrl;
        this.sourceType = SourceType.OTHER;
    }

    public SourceType getSourceType() {
        return this.sourceType;
    }

    public String getSourceUrl() {
        return sourceUrl;
    }

    public int getId() {
        return this.id;
    }

    public String getIdString() {
        return String.valueOf(this.id);
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        RawVulnerability that = (RawVulnerability) o;
        return id == that.id;
    }
}
